# language: fr
@nature-de-l-exploitation
Fonctionnalité: Enregistrer le changement de nature de l'exploitation d'un projet lauréat en tant que porteur

    Contexte:
        Etant donné le projet lauréat "Du boulodrome de Marseille" avec :
            | appel d'offres                   | PPE2 - Petit PV Bâtiment        |
            | type de nature de l'exploitation | vente-avec-injection-du-surplus |
            | taux prévisionnel aci            | 99                              |
        Et la dreal "Dreal du sud" associée à la région du projet

    Scénario: Enregistrer le changement de nature de l'exploitation d'un projet lauréat
        Quand le porteur enregistre un changement de nature de l'exploitation du projet lauréat avec :
            | type de nature de l'exploitation | <Type> |
            | taux prévisionnel aci            | <Taux> |
        Alors la nature de l'exploitation du projet lauréat devrait être mise à jour
        Et un email a été envoyé à la dreal avec :
            | sujet      | Potentiel - Déclaration de changement de nature de l'exploitation pour le projet Du boulodrome de Marseille dans le département(.*) |
            | nom_projet | Du boulodrome de Marseille                                                                                                          |
            | url        | https://potentiel.beta.gouv.fr/projet/.*/details.html                                                                               |

        Exemples:
            | Type                             | Taux |
            | vente-avec-injection-du-surplus  | 40   |
            | vente-avec-injection-en-totalité |      |

    Scénario: Impossible d'enregistrer le changement de nature de l'exploitation d'un projet lauréat abandonné
        Etant donné un abandon accordé pour le projet lauréat
        Quand le porteur enregistre un changement de nature de l'exploitation du projet lauréat
        Alors le porteur devrait être informé que "Impossible de faire un changement pour un projet abandonné"

    Scénario: Impossible d'enregistrer le changement de nature de l'exploitation d'un projet lauréat achevé
        Etant donné une attestation de conformité transmise pour le projet lauréat
        Quand le porteur enregistre un changement de nature de l'exploitation du projet lauréat
        Alors le porteur devrait être informé que "Impossible de faire un changement pour un projet achevé"

    Scénario: Impossible de modifier la nature de l'exploitation avec une valeur identique
        Quand le porteur enregistre un changement de nature de l'exploitation avec une valeur identique pour le projet lauréat
        Alors l'utilisateur devrait être informé que "La nouvelle nature de l'exploitation est identique à celle associée au projet"

    Scénario: Impossible de modifier la nature de l'exploitation sans taux prévisionnel ACI si le type de nature de l'exploitation est avec injection du surplus
        Quand le porteur enregistre un changement de nature de l'exploitation du projet lauréat avec :
            | type de nature de l'exploitation | vente-avec-injection-du-surplus |
            | taux prévisionnel aci            |                                 |
        Alors l'utilisateur devrait être informé que "Le taux d'autoconsommation individuelle prévisionnel est requis"

    Scénario: Impossible de modifier la nature de l'exploitation avec taux prévisionnel ACI si le type de nature de l'exploitation est avec injection en totalié
        Quand le porteur enregistre un changement de nature de l'exploitation du projet lauréat avec :
            | type de nature de l'exploitation | vente-avec-injection-en-totalité |
            | taux prévisionnel aci            | 5                                |
        Alors l'utilisateur devrait être informé que "Le taux d'autoconsommation individuelle prévisionnel ne peut être renseigné"
