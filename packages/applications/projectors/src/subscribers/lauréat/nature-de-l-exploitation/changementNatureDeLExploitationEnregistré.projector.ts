import {
  updateOneProjection,
  upsertProjection,
} from '@potentiel-infrastructure/pg-projection-write';
import { Lauréat } from '@potentiel-domain/projet';

export const changementNatureDeLExploitationEnregistréProjector = async ({
  payload: {
    identifiantProjet,
    enregistréLe,
    typeNatureDeLExploitation,
    tauxPrévisionnelACI,
    enregistréPar,
    // raison,
    // pièceJustificative,
  },
}: Lauréat.NatureDeLExploitation.ChangementNatureDeLExploitationEnregistréEvent) => {
  await updateOneProjection<Lauréat.NatureDeLExploitation.NatureDeLExploitationEntity>(
    `nature-de-l-exploitation|${identifiantProjet}`,
    {
      typeNatureDeLExploitation,
      tauxPrévisionnelACI,
      misÀJourLe: enregistréLe,
    },
  );

  await upsertProjection<Lauréat.NatureDeLExploitation.ChangementNatureDeLExploitationEntity>(
    `changement-nature-de-l-exploitation|${identifiantProjet}#${enregistréLe}`,
    {
      identifiantProjet,
      changement: {
        typeNatureDeLExploitation,
        tauxPrévisionnelACI,
        enregistréPar,
        enregistréLe,
        // raison,
        // pièceJustificative,
      },
    },
  );
};
